<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>صفحتي الشخصية</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; direction: rtl; }
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
    }

    .header {
      background-color: #1877f2;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      position: relative;
    }

    .search-bar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.6);
      padding: 8px 12px;
      border-radius: 20px;
    }

    .search-bar input {
      background: transparent;
      border: none;
      color: white;
      outline: none;
      font-size: 14px;
    }

    .settings {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }

    .settings-menu {
      position: absolute;
      top: 50px;
      right: 10px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      display: none;
      z-index: 999;
    }

    .settings-menu div {
      padding: 6px 12px;
      cursor: pointer;
    }

    .cover {
      width: 100%;
      height: 250px;
      background: url('https://via.placeholder.com/1000x250/1877f2/ffffff?text=Cover+Photo') center/cover no-repeat;
      position: relative;
    }

    .profile-pic {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 5px solid white;
      position: absolute;
      bottom: -75px;
      left: 30px;
      background: center/cover no-repeat #ddd;
      cursor: pointer;
    }

    .profile-info {
      background-color: white;
      padding: 20px;
      margin: 100px auto 20px;
      max-width: 800px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .username {
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #1c1e21;
    }

    .logout-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #e4e6eb;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .section {
      margin-top: 20px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }

    .section-title {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .detail-item {
      margin-bottom: 10px;
    }

    .edit-form input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }

    .edit-form button {
      padding: 10px;
      background: #1877f2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .search-results {
      margin-top: 20px;
      background: #fff;
      border-radius: 6px;
      display: none;
    }

    .search-results div {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }

    .search-results div:last-child {
      border-bottom: none;
    }

  </style>
</head>
<body>

  <div class="header">
    صفحتي الشخصية
    <div class="settings" onclick="toggleSettings()">⚙️</div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="ابحث عن الأصدقاء" onkeydown="searchKeyDown(event)">
    </div>
    <div class="settings-menu" id="settingsMenu">
      <div onclick="showSection('details')">التفاصيل الشخصية</div>
      <div onclick="showSection('edit')">تعديل اسم المستخدم وكلمة المرور</div>
    </div>
  </div>

  <div class="cover">
    <div class="profile-pic" id="profile-pic"></div>
  </div>

  <div class="profile-info">
    <div class="username">أهلاً <span id="user"></span>!</div>

    <!-- التفاصيل الشخصية -->
    <div id="detailsSection" class="section">
      <div class="section-title">التفاصيل الشخصية</div>
      <div class="detail-item">👤 اسم المستخدم: <span id="detailUsername"></span></div>
      <div class="detail-item">🔒 كلمة المرور: <span id="detailPassword">●●●●●</span>
        <button onclick="togglePassword()">إظهار</button>
      </div>
    </div>

    <!-- نموذج تعديل -->
    <div id="editSection" class="section">
      <div class="section-title">تعديل البيانات</div>
      <div class="edit-form">
        <label>اسم المستخدم الجديد:</label>
        <input type="text" id="newUsername">
        <label>كلمة المرور الجديدة:</label>
        <input type="text" id="newPassword">
        <button onclick="saveChanges()">حفظ التغييرات</button>
      </div>
    </div>

    <!-- نتائج البحث -->
    <div class="search-results" id="searchResults"></div>

    <button class="logout-btn" id="logout">تسجيل الخروج</button>
  </div>

  <script>
    const user = localStorage.getItem('authUser');
    let users = JSON.parse(localStorage.getItem('users') || '[]');
    let userData = users.find(u => u.username === user);

    if (!user || !userData) {
      location.href = 'index.html';
    } else {
      document.getElementById('user').textContent = userData.username;
      document.getElementById('detailUsername').textContent = userData.username;
      document.getElementById('detailPassword').setAttribute('data-real', userData.password);

      const savedPic = localStorage.getItem('profilePic_' + user);
      if (savedPic) {
        document.getElementById('profile-pic').style.backgroundImage = `url(${savedPic})`;
      }

      document.getElementById('profile-pic').onclick = () => {
        alert("يمكنك رفع صورة هنا مستقبلاً");
      };
    }

    function toggleSettings() {
      const menu = document.getElementById('settingsMenu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function showSection(type) {
      document.getElementById('detailsSection').style.display = type === 'details' ? 'block' : 'none';
      document.getElementById('editSection').style.display = type === 'edit' ? 'block' : 'none';

      if (type === 'edit') {
        document.getElementById('newUsername').value = userData.username;
        document.getElementById('newPassword').value = userData.password;
      }

      document.getElementById('settingsMenu').style.display = 'none';
    }

    function togglePassword() {
      const span = document.getElementById('detailPassword');
      const real = span.getAttribute('data-real');
      span.textContent = span.textContent === '●●●●●' ? real : '●●●●●';
    }

    function saveChanges() {
      const newUsername = document.getElementById('newUsername').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();

      if (!newUsername || !newPassword) {
        alert('يرجى ملء البيانات');
        return;
      }

      users = users.map(u => {
        if (u.username === user) {
          u.username = newUsername;
          u.password = newPassword;
        }
        return u;
      });

      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('authUser', newUsername);
      alert('تم تحديث البيانات');
      location.reload();
    }

    document.getElementById('logout').onclick = () => {
      localStorage.removeItem('authUser');
      location.href = 'index.html';
    };

    function searchKeyDown(e) {
      if (e.key === 'Enter') {
        const query = e.target.value.trim();
        if (!query) return;

        const results = users.filter(u => u.username.includes(query));
        const container = document.getElementById('searchResults');
        container.innerHTML = '';
        container.style.display = 'block';

        if (results.length === 0) {
          container.innerHTML = '<div>لا يوجد مستخدم بهذا الاسم</div>';
        } else {
          results.forEach(u => {
            const div = document.createElement('div');
            div.textContent = u.username;
            div.onclick = () => alert(`اسم المستخدم: ${u.username}`);
            container.appendChild(div);
          });
        }
      }
    }
  </script>

</body>
</html>
